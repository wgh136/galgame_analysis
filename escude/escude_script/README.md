# escude 脚本文件

适用于对`script.bin`文件解包后的bin文件, 
且文件以`40 65 73 63 75 3A 64 65`(@escu:de)开头

## 文件构成

文件由文件头, 元数据, 控制部分, 文本段构成. 文本段由索引表和数据区域构成, 索引表4字节一组, 从0开始, 表示字符串在该文本段数据区域的偏移, 数据区域由字符串构成, 字符串以空字符结尾

- 0x00 - 0x07: 文件头
- 0x08 - 0x0B: 控制部分长度
- 0x0C - 0x0F: 是否为两个文本段, 若是, 值为1, 否则, 值为0
- 0x10 - 0x13: 若有两个文本段, 值不为零, 表示第一个文本段的数据区域总长度, 不包含索引表长度
- 0x14 - 0x17: 表示最后一个文本段的字符串数量
- 0x18 - 0x1B: 最后一个文本段数据区域长度, 不包含索引表长度
- 0x1C - (0x1C + 控制部分长度): 控制部分
- 剩余: 文本段, 可能有两个

提取文本时, 首先判断是否为两个文本段, 若是, 从`0x1C + 控制部分长度`开始处理, 这是第一个文本段索引表开始位置, 第一个文本段索引表结束位置为`总长度 - 第二个文本段长度 - 4 * 第二个文本段字符串数量`, 之后同理

## 程序使用说明

### 编译

```bash
g++ main.cpp -o escude_script -std=c++17
```

注意：由于使用了std::filesystem功能，需要C++17支持。

### 使用方法

#### 提取文本

从脚本文件中提取文本并保存到文本文件中：

```bash
./escude_script -e <脚本文件路径> <输出文本文件路径>
```

示例：

```bash
./escude_script -e script_01.bin extracted_text.txt
```

#### 修改文本

从文本文件读取内容并修改脚本文件：

```bash
./escude_script -m <脚本文件路径> <输入文本文件路径>
```

示例：

```bash
./escude_script -m script_01.bin modified_text.txt
```

#### 批量提取文本

从目录中提取所有.bin文件的文本：

```bash
./escude_script -be <输入目录> <输出目录>
```

示例：

```bash
./escude_script -be ./scripts/ ./extracted_texts/
```

这将处理`./scripts/`目录中的所有.bin文件，并将提取的文本保存到`./extracted_texts/`目录中，文件名保持一致（仅扩展名改为.txt）。

#### 批量修改文本

根据文本文件批量修改脚本文件：

```bash
./escude_script -bm <输入目录> <输出目录>
```

示例：

```bash
./escude_script -bm ./modified_texts/ ./modified_scripts/
```

这将使用`./modified_texts/`目录中的所有.txt文件来修改`./modified_scripts/`目录中对应名称的.bin文件。

### 注意事项

- 修改文本时，文本文件中的行数必须与原脚本文件中的文本条目数量一致
- 每行文本对应脚本文件中的一个文本条目
- 提取出的文本保持原始编码，请确保文本编辑器使用正确的编码方式打开文件
- 批量修改文本时，需要确保输出目录中已存在对应的.bin文件
- 批量处理会自动创建输出目录（如果不存在）

### 测试游戏

- 放課後⇒エデュケーション！～先生とはじめる魅惑のレッスン～
